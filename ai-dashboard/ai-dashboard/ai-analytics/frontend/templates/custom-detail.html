<!DOCTYPE html>
<html>
<head>
  <title>Report Detail</title>
  <link rel="stylesheet" href="../css/dashboard.css">
</head>
<body>

<div class="container">

  <div class="custom-header-row">
    <h2 class="page-title">Report Detail</h2>
    <button class="ai-btn" onclick="openDashboard()">AI DASHBOARD</button>
  </div>

  <div class="custom-table-card">
    <table class="custom-table">
      <thead>
        <tr></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script>
const API = "http://localhost:8000";

/* ================================
   READ URL PARAMS (CORRECT)
================================ */
const params = new URLSearchParams(window.location.search);
const reportType = params.get("report_type");
const reportId   = params.get("report_id");

if (!reportType || !reportId) {
  alert("Missing report_type or report_id in URL");
}

/* ================================
   FETCH EXCEL DATA
================================ */
fetch(`${API}/reports/design/${reportType}/detail/${reportId}/data`)
  .then(res => {
    if (!res.ok) {
      throw new Error("Failed to load report data");
    }
    return res.json();
  })
  .then(data => {
    const thead = document.querySelector("thead tr");
    const tbody = document.querySelector("tbody");

    thead.innerHTML = "";
    data.columns.forEach(col => {
      thead.innerHTML += `<th>${col}</th>`;
    });

    tbody.innerHTML = "";
    data.rows.forEach(row => {
      const tr = document.createElement("tr");
      data.columns.forEach(col => {
        tr.innerHTML += `<td>${row[col] ?? ""}</td>`;
      });
      tbody.appendChild(tr);
    });
  })
  .catch(err => {
    console.error(err);
    alert("Error loading Excel data");
  });

/* ================================
   OPEN AI DASHBOARD
================================ */
function openDashboard() {
  window.location.href =
    `ai-dashboard.html?report_type=${reportType}&report_id=${reportId}`;
}
</script>

</body>
</html>
